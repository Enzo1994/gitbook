# 第一步、初始化运行时环境
## 这个环境包括：
1. 堆空间和栈空间
2. 全局执行上下文
3. 全局作用域
4. 内置内建函数
5. 宿主环境提供的扩展函数和对象
6. 消息循环系统

## 宿主：
1. Web API
2. Window DOM
3. 事件循环
4. 消息队列
5. 堆栈

## V8：
1. JavaScript核心
2. 垃圾回收

## 解剖：
### 1. 第一步、初始化基础数据存储空间：堆空间和栈空间
只要打开一个渲染进程，渲染进程便会初始化 V8，同时初始化堆空间和栈空间。

栈空间主要是用来管理 JavaScript 函数调用的，栈是内存中连续的一块空间，同时栈结构是“先进后出”的策略。在函数调用过程中，涉及到上下文相关的内容都会存放在栈上，比如原生类型、引用到的对象的地址、函数的执行状态、this 值等都会存在在栈上。当一个函数执行结束，那么该函数的执行上下文便会被销毁掉。

要在内存中找到一块连续的区域却显得有点难度，于是所有的程序都限制栈空间的大小，这就是我们经常容易出现栈溢出的一个主要原因。

堆空间是一种树形的存储结构，用来存储对象类型的离散的数据，在前面的课程中我们也讲过，JavaScript 中除了原生类型的数据，其他的都是对象类型，诸如函数、数组，在浏览器中还有 window 对象、document 对象等，这些都是存在堆空间的。

### 2. 第二步、初始化全局执行上下文和全局作用域
简化：window、global、document等等宿主提供的内容，会在启动过程中准备好，我们把这些称为全局执行上下文
全局执行上下文和函数执行上下文，摞成了调用栈

```js
var x = 1
function show_x(){
    console.log(x)
}
function bar(){
  show_x（）
}
bar()

// 调用栈：
|__show_x函数执行上下文__|  
|____bar函数执行上下文___|  
|_____全局执行上下文_____|
```

### 3. 第三步、构造事件循环系统：
因为所有的任务都是运行在主线程的，在浏览器的页面中，V8 会和页面共用主线程，共用消息队列，所以如果 V8 执行一个函数过久，会影响到浏览器页面的交互性能。

>参考node中的libuv，事件驱动

## 总结：
在执行时，它的一部分基础环境是由宿主提供的，这包括了全局执行上下文、事件循环系统，堆空间和栈空间。除了需要宿主提供的一些基础环境之外，V8 自身会提供 JavaScript 的核心功能和垃圾回收系统。

要在内存中找到一块连续的区域却显得有点难度，于是所有的程序都限制栈空间的大小，这就是我们经常容易出现栈溢出的一个主要原因。

如果不经常使用的变量或者数据，最好不要放到全局执行上下文中。